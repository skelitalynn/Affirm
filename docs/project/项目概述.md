# Affirm - 显化导师Agent

## 📋 项目概述
基于 OpenClaw + Telegram 构建一个"显化导师"Agent，特点是 Prompt 极简、长期记忆可持续、每天自动归档对话到 Notion，并提供独立后台用于配置个人画像与目标。

## 🎯 目标与非目标

### 目标
1. 以年为单位的长期记忆，不依赖上下文长度。
2. 每天 00:00 自动将当天对话原文写入 Notion 的父页面下的子页面。
3. 支持后台配置个人画像与目标，不依赖聊天解析。
4. 支持纯文本知识注入，并可被检索用于对话。
5. 以 OpenClaw 作为核心编排与工具调用框架。

### 非目标
1. 不做复杂的情绪分析或摘要处理。
2. 不做多用户、SaaS 化能力。
3. 不做前端复杂交互，仅提供最小后台配置页。

## 🏗️ 总体架构

### 组件
1. **Telegram** - 对话入口
2. **OpenClaw** - 编排与工具调用层
3. **LLM** - 使用 GPT-5.3-Codex（通过代理）
4. **数据层** - PostgreSQL + pgvector
5. **归档载体** - Notion（每日对话归档）
6. **配置界面** - 独立后台页面

### 关键设计
1. **Prompt 极简** - 个性化与记忆依赖数据层完成
2. **数据统一存储** - 向量检索与结构化查询在同一数据库完成
3. **Notion 写入为定时任务** - 不参与实时对话路径

## 📅 7天开发计划

### Day 1 (2026-02-25)：环境搭建 + 数据库 ✅
**目标**：完成基础环境配置
**状态**：✅ 100% 完成

### Day 2 (2026-02-26)：核心数据层
**目标**：实现数据访问层
**任务**：
- 安装项目依赖
- 实现messages表的CRUD操作
- 实现向量嵌入生成和存储
- 实现语义检索功能
- 编写基础测试

### Day 3 (2026-02-27)：OpenClaw集成
**目标**：集成OpenClaw框架
**任务**：
- 创建OpenClaw技能文件
- 实现Telegram消息处理
- 集成记忆召回功能
- 配置AI模型调用
- 实现基础对话流程

### Day 4 (2026-02-28)：Notion集成
**目标**：实现每日归档功能
**任务**：
- 配置Notion API连接
- 实现Notion页面创建功能
- 创建每日归档定时任务
- 实现对话原文导出
- 添加归档状态跟踪

### Day 5 (2026-03-01)：后台配置页
**目标**：创建管理界面
**任务**：
- 创建简易Web界面
- 实现profiles表的管理
- 添加知识注入功能
- 实现基本权限控制
- 界面美化优化

### Day 6 (2026-03-02)：测试优化
**目标**：完善和测试
**任务**：
- 编写单元测试
- 进行集成测试
- 性能优化（召回限制等）
- 错误处理完善
- 文档更新

### Day 7 (2026-03-03)：部署上线
**目标**：部署到生产环境
**任务**：
- 配置生产环境变量
- 设置监控和日志
- 数据库备份策略
- 最终测试验证
- 项目总结文档

## 🔧 技术栈

### 后端
- **运行时**: Node.js 18+
- **框架**: OpenClaw
- **数据库**: PostgreSQL 15+ with pgvector
- **AI模型**: GPT-5.3-Codex（代理）

### 外部服务
- **消息平台**: Telegram Bot API
- **文档归档**: Notion API
- **版本控制**: Git + GitHub
- **自动化**: OpenClaw Cron

### 部署环境
- **服务器**: 腾讯云
- **时区**: Asia/Shanghai (UTC+08:00)
- **监控**: 系统日志 + 应用日志

## ⚙️ 配置说明

### 环境变量 (.env)
```bash
# 数据库配置
DB_URL=postgresql://username:password@localhost:5432/database_name

# Telegram配置
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# AI模型配置（Codex 5.3代理）
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_BASE_URL=https://api.ikuncode.cc/v1
MODEL_NAME=gpt-5.3-codex

# GitHub配置（SSH方式）
GITHUB_USERNAME=skelitalynn
GITHUB_REPO=Affirm

# OpenClaw配置
OPENCLAW_GATEWAY_URL=http://localhost:18789
OPENCLAW_GATEWAY_TOKEN=your_openclaw_gateway_token

# Notion配置（Day 4配置）
NOTION_TOKEN=先留空
NOTION_PARENT_PAGE_ID=先留空

# 项目配置
TIMEZONE=Asia/Shanghai
LOG_LEVEL=info
NODE_ENV=development

# 安全配置
JWT_SECRET=affirm_project_secret_key_2026_change_this
ENCRYPTION_KEY=affirm_encryption_key_2026_change_this
```

## 🚀 快速开始

### 1. 环境准备
```bash
# 安装PostgreSQL和pgvector
sudo dnf install -y postgresql-server postgresql-devel
sudo postgresql-setup --initdb
sudo systemctl start postgresql

# 安装Node.js依赖
npm install
```

### 2. 数据库初始化
```bash
# 执行数据库初始化脚本
psql -f scripts/database/schemas/init.sql
```

### 3. 启动服务
```bash
npm start
```

### 4. 验证环境
```bash
# 运行环境验证
./scripts/utils/verify-environment.sh
```

## 📞 支持与维护

### 问题排查
- **数据库问题**: 检查PostgreSQL服务状态和连接配置
- **API问题**: 验证Telegram和AI API密钥
- **部署问题**: 检查环境变量和端口配置

### 监控日志
- 应用日志: `logs/app.log`
- 数据库日志: `/var/lib/pgsql/data/log/`
- OpenClaw日志: `openclaw logs --follow`

## 📄 许可证

MIT License - 详见 LICENSE 文件

---
**项目状态**: Day 1 ✅ 完成 | 总体进度: 14.3%
**最新更新**: 2026-02-25
**维护者**: 小苹果 🍎